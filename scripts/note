#!/bin/sh
#note usage
#       note = show latest isosec note
#       note new = add a note in directory
#       note ls = show titles of notes in directory
#       note rm = remove last note
#       note edit = edit last note
#
#       note <isosec> edit
#       note <isosec> rm

edit() {
  vim "$1/README.md"
}

list() {
  head -1 ./*/README.md | grep '^#' | sed 's/^\# //'
}

showhelp() {
  awk 'NR >= 2 && NR <= 10' "$(readlink -f "$0")" | grep '^#' | sed 's/^\#//'
}

remove() {
  rm -rI "$1"
}

l=""
last() {
  l=$(find . -mindepth 1 -maxdepth 1 -type d | sort -n | tail -n 1 | sed 's/\.\///')
}

new() {
  d="$(isosec)"
  mkdir "$d"
  edit "$d"
}

show() {
  cat "$1/README.md"
}

test -z "$1" && last && echo "$l" && exit 0

test "$1" = "edit" && edit "$(note)" && exit 0
test "$1" = "remove" -o "$1" = "rm" && remove "$(note)" && exit 0
test "$1" = "show" -o "$1" = "view" && show "$(note)" && exit 0

test "$1" = "new" -o "$1" = "add" && new && exit 0
test "$1" = "list" -o "$1" = "ls" && list && exit 0
test "$1" = "help" -o "$1" = "h" && showhelp && exit 0

if [ -d "$1" ]; then
  test "$2" = "edit" && edit "$1" && exit 0
  test "$2" = "remove" -o "$2" = "rm" && remove "$1" && exit 0
  test "$2" = "show" -o "$2" = "view" && show "$1" && exit 0
fi

echo "Usage: $(basename "$0") help" && exit 1
